# 📊 滚动PE估值计算器

一个基于PE估值法的美股个股投资分析工具，帮助投资者快速分析股票的合理价格区间。

## 🎯 功能特点

- **自动数据获取**: 通过Yahoo Finance API获取股票历史价格和EPS数据
- **滚动PE区间计算**: 基于历史数据计算滚动PE区间和统计指标
- **前瞻估值分析**: 结合前瞻EPS预测给出未来估值范围
- **可视化图表**: 提供直观的滚动PE趋势图和估值分析图表
- **参数调整**: 支持手动调整滚动PE区间和EPS数值
- **智能缓存**: 内置缓存管理系统，减少API调用，提高加载速度
- **API调用限制**: 内置API调用计数和限制功能，防止超出免费额度（50次/天）
- **错误恢复**: 当API受限时自动使用缓存数据，确保应用持续可用
- **缓存状态监控**: 实时显示各类数据的缓存状态和过期时间

## 🛠️ 技术栈

- **前端界面**: Streamlit
- **数据获取**: yfinance
- **数据处理**: pandas, numpy
- **可视化**: plotly
- **网页解析**: ~~BeautifulSoup4~~ (已移除爬虫功能)
- **缓存管理**: 自定义CacheManager

## 📦 安装说明

1. 克隆或下载项目到本地
2. 安装Python依赖包：

```bash
pip install -r requirements.txt
```

## 🚀 使用方法

1. 启动应用：

```bash
streamlit run main.py
```

2. 在浏览器中打开显示的本地地址（通常是 http://localhost:8501）

3. 在侧边栏输入美股代码（如 NVDA, AAPL, GOOGL）

4. 点击"获取数据"按钮开始分析

5. 根据需要调整滚动PE区间和前瞻EPS数值

6. 点击"重新计算估值"获得更新结果

## 📊 分析方法

### 滚动PE区间计算
- 使用过去12个月的每日股价数据
- 计算每日滚动PE值（股价 ÷ TTM EPS）
- 采用"均值 ± 1标准差"作为滚动PE区间
- 提供完整的统计指标（均值、中位数、标准差等）

### 前瞻估值
- 支持未来两个财年的EPS预测
- 计算公式：估值 = 滚动PE区间 × 前瞻EPS
- 提供估值下限、上限和中位值
- 支持手动调整所有参数

## 💾 缓存管理

- **智能缓存策略**: 自动缓存股票数据和计算结果，减少API调用
- **缓存状态监控**: 实时显示各类数据的缓存状态和过期时间
- **手动刷新**: 支持强制刷新数据，获取最新信息
- **缓存统计**: 提供详细的缓存使用统计和清理功能
- **自动维护**: 自动清理损坏和过期的缓存文件
- **错误恢复**: API受限时自动切换到缓存数据模式

## 🚦 API限制管理

- **调用计数**: 内置API调用计数器，实时监控使用情况
- **智能限制**: 每日50次API调用限制，防止超出免费额度
- **自动保护**: 达到限制时自动停止新请求，使用缓存数据
- **状态显示**: 侧边栏显示当前API调用状态和剩余次数
- **手动重置**: 支持手动重置API限制状态（新的一天开始时）

## 📁 项目结构

```
估值计算/
├── main.py              # 主程序文件（Streamlit应用）
├── cache_manager.py     # 缓存管理模块
├── cache/               # 缓存数据目录（自动创建）
├── requirements.txt     # Python依赖包列表
├── README.md            # 项目说明文档
├── .gitignore          # Git忽略文件配置
└── .vercel/            # Vercel部署配置
```

## 🔧 最近更新

### v1.2.0 (最新)
- 🐛 修复了多个关键错误：
  - 解决 "'dict' object is not callable" 错误
  - 修复 "NameError: name 'cache_warning' is not defined" 问题
  - 解决 "TypeError: string indices must be integers" 缓存状态显示错误
- 🔄 API调用限制调整为50次/天
- 📊 改进缓存状态显示逻辑
- 🛡️ 增强错误恢复机制
- 💡 优化用户界面提示信息

## 📈 使用示例

以AAPL为例的分析结果：

| 财年 | 前瞻EPS | 滚动PE区间 | 估值范围 |
|------|---------|--------|----------|
| FY2024 | $8.31 | 32.39–37.11 | $269.16 – $308.38（中位：$290.19） |
| FY2025 | $9.00 | 32.39–37.11 | $291.51 – $333.99（中位：$314.28） |

## ⚠️ 重要声明

- 本工具仅供投资分析参考，不构成投资建议
- 滚动PE估值法有其局限性，建议结合其他分析方法
- 前瞻EPS预测存在不确定性，请谨慎使用
- 投资有风险，决策需谨慎

